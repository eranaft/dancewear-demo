<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Studio Wear ‚Ä¢ Demo</title>

  <style>
    :root{
      --radius: 22px;
      --ease: cubic-bezier(.2,.9,.2,1);

      --cyan:#00c9ff;
      --orange:#ff7a18;

      /* light (default) */
      --bg:#f6f8ff;
      --bg2:#f2f6ff;
      --glass: rgba(255,255,255,.62);
      --glass2: rgba(255,255,255,.80);
      --stroke: rgba(16,24,40,.10);
      --stroke2: rgba(16,24,40,.14);
      --text:#0b1020;
      --muted: rgba(11,16,32,.62);
      --shadow: 0 26px 80px rgba(11,16,32,.12);
      --shadow2: 0 18px 50px rgba(11,16,32,.10);
      --toastBg: rgba(255,255,255,.78);
      --toastText: #0b1020;
      --modalBg: rgba(11,16,32,.22);
    }

    /* dark theme overrides */
    [data-theme="dark"]{
      --bg:#070a10;
      --bg2:#0b1220;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.14);
      --stroke2: rgba(255,255,255,.22);
      --text:#f6f8ff;
      --muted: rgba(246,248,255,.68);
      --shadow: 0 26px 90px rgba(0,0,0,.55);
      --shadow2: 0 18px 60px rgba(0,0,0,.42);
      --toastBg: rgba(0,0,0,.56);
      --toastText: #fff;
      --modalBg: rgba(0,0,0,.44);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 12% -10%, rgba(0,201,255,.22), transparent 60%),
        radial-gradient(820px 520px at 95% 0%, rgba(255,122,24,.18), transparent 60%),
        radial-gradient(720px 420px at 55% 120%, rgba(0,201,255,.12), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      -webkit-tap-highlight-color: transparent;
      overflow-x:hidden;
    }

    /* live ‚Äúshine‚Äù layer */
    body:before{
      content:"";
      position:fixed;
      inset:-20%;
      pointer-events:none;
      background:
        radial-gradient(900px 420px at 40% 10%, rgba(255,255,255,.50), transparent 60%),
        radial-gradient(700px 360px at 70% 40%, rgba(255,255,255,.32), transparent 62%),
        conic-gradient(from 180deg at 50% 35%, rgba(0,201,255,.08), rgba(255,122,24,.06), rgba(0,201,255,.08));
      filter: blur(18px);
      opacity: .55;
      z-index:0;
      transform: translateZ(0);
      animation: floatShine 10s var(--ease) infinite alternate;
    }
    [data-theme="dark"] body:before{
      opacity:.45;
      filter: blur(22px);
    }
    @keyframes floatShine{
      from{ transform: translate3d(-1%, -1%, 0) scale(1); }
      to{ transform: translate3d(1%, 1%, 0) scale(1.02); }
    }

    .container{
      position:relative;
      z-index:1;
      max-width: 1040px;
      margin: 0 auto;
      padding: 0 14px;
    }

    /* ===== Header ===== */
    header{
      position: sticky;
      top: 0;
      z-index: 50;
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      backdrop-filter: blur(18px) saturate(180%);
      border-bottom: 1px solid var(--stroke);
    }

    .head{
      padding: 14px 0 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .brand{ display:flex; flex-direction:column; gap:5px; min-width:0; }
    .brand a{
      color:var(--text);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
      width:fit-content;
    }

    .logoDot{
      width:10px; height:10px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.20));
      box-shadow:
        0 0 0 6px rgba(0,201,255,.10),
        0 0 26px rgba(0,201,255,.22),
        0 0 18px rgba(255,122,24,.16);
      flex:0 0 auto;
    }

    .title{
      font-size: clamp(18px, 3.8vw, 22px);
      font-weight: 980;
      letter-spacing: .45px;
      line-height: 1.05;
    }
    .subtitle{
      color:var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .topActions{ display:flex; gap:10px; align-items:center; flex:0 0 auto; }

    .iconBtn{
      position:relative;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), border-color .18s var(--ease);
      user-select:none;
      overflow:hidden;
    }
    .iconBtn:active{ transform: scale(.95); }
    @media (hover:hover){
      .iconBtn:hover{ transform: translateY(-1px); border-color: var(--stroke2); box-shadow: 0 22px 60px rgba(0,0,0,.18); }
      [data-theme="dark"] .iconBtn:hover{ box-shadow: 0 22px 70px rgba(0,0,0,.44); }
    }

    .icon{ width: 20px; height: 20px; display:block; color: color-mix(in srgb, var(--text) 92%, transparent); }

    /* cart badge stable */
    .badge{
      position:absolute;
      top: 0;
      right: 0;
      transform: translate(50%,-50%);
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.78));
      color:#0b1020;
      font-size: 11px;
      font-weight: 980;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 12px 26px rgba(0,0,0,.18);
      border: 2px solid color-mix(in srgb, var(--bg) 86%, transparent);
      will-change: transform;
    }
    [data-theme="dark"] .badge{
      border-color: rgba(10,14,22,.75);
      color:#0a0e16;
    }
    @keyframes bumpBadge{
      0%{ transform: translate(50%,-50%) scale(1); }
      35%{ transform: translate(50%,-50%) scale(1.18); }
      100%{ transform: translate(50%,-50%) scale(1); }
    }
    .bumpBadge{ animation: bumpBadge .28s var(--ease); }

    /* ===== Layout ===== */
    main{ padding: 14px 0 120px; }

    .panel{
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
      position:relative;
      overflow:hidden;
    }
    .panel:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 220px at 20% 0%, rgba(0,201,255,.16), transparent 58%),
        radial-gradient(520px 220px at 80% 0%, rgba(255,122,24,.12), transparent 58%);
      opacity:.8;
      pointer-events:none;
    }
    .panel > *{ position:relative; }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap: wrap; }

    input, textarea{
      width:100%;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      padding: 12px 14px;
      color: var(--text);
      outline: none;
      font-weight: 650;
      min-width: 0;
      transition: border-color .18s var(--ease), box-shadow .18s var(--ease), background .18s var(--ease);
    }
    input::placeholder, textarea::placeholder{ color: color-mix(in srgb, var(--text) 45%, transparent); }
    input:focus, textarea:focus{
      border-color: rgba(0,201,255,.45);
      box-shadow: 0 0 0 4px rgba(0,201,255,.18);
      background: color-mix(in srgb, var(--glass2) 88%, transparent);
    }
    textarea{ min-height: 90px; resize: vertical; }

    .chip{
      width:auto;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      color: color-mix(in srgb, var(--text) 92%, transparent);
      padding: 9px 12px;
      border-radius: 999px;
      font-weight: 950;
      cursor:pointer;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), border-color .18s var(--ease), background .18s var(--ease);
      user-select:none;
    }
    .chip:active{ transform: scale(.98); }
    .chip.active{
      background: linear-gradient(135deg, rgba(0,201,255,.26), rgba(255,122,24,.12));
      border-color: var(--stroke2);
      box-shadow: 0 18px 60px rgba(0,201,255,.12);
    }

    .hint{
      margin-top:10px;
      color: var(--muted);
      font-size: 12.5px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .hint span{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 80%, transparent);
    }

    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 12px;
      align-items: stretch;
    }

    .productCard{
      position: relative;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 22px 70px rgba(0,0,0,.14);
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), border-color .18s var(--ease);
      display:flex;
      flex-direction:column;
      min-width:0;
      will-change: transform;
    }
    [data-theme="dark"] .productCard{ box-shadow: 0 22px 90px rgba(0,0,0,.40); }
    @media (hover:hover){
      .productCard:hover{
        transform: translateY(-2px);
        border-color: var(--stroke2);
      }
    }
    .productCard:active{ transform: scale(.99); }

    /* fake image variations */
    .pImg{
      position: relative;
      height: 150px;
      display:flex;
      align-items:flex-end;
      padding: 12px;
      cursor:pointer;
      border-bottom: 1px solid color-mix(in srgb, var(--stroke) 65%, transparent);
      overflow:hidden;
    }
    .pImg:after{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(closest-side, rgba(255,255,255,.55), transparent 60%);
      opacity: .35;
      transform: rotate(18deg) translateX(-12%);
      pointer-events:none;
      animation: sweep 7s var(--ease) infinite;
    }
    [data-theme="dark"] .pImg:after{ opacity:.18; }

    @keyframes sweep{
      0%{ transform: rotate(18deg) translateX(-30%); }
      50%{ transform: rotate(18deg) translateX(12%); }
      100%{ transform: rotate(18deg) translateX(-30%); }
    }

    .imgV1{
      background:
        radial-gradient(240px 140px at 22% 25%, rgba(0,201,255,.26), transparent 62%),
        radial-gradient(220px 140px at 78% 60%, rgba(255,122,24,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.86), rgba(255,255,255,.42));
    }
    .imgV2{
      background:
        radial-gradient(260px 140px at 30% 30%, rgba(255,122,24,.20), transparent 62%),
        radial-gradient(220px 140px at 72% 62%, rgba(0,201,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.44));
    }
    .imgV3{
      background:
        radial-gradient(260px 140px at 24% 28%, rgba(0,201,255,.22), transparent 62%),
        radial-gradient(240px 140px at 76% 58%, rgba(255,122,24,.14), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.90), rgba(255,255,255,.46));
    }
    .imgV4{
      background:
        radial-gradient(260px 140px at 20% 25%, rgba(255,122,24,.18), transparent 62%),
        radial-gradient(240px 140px at 80% 58%, rgba(0,201,255,.16), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.42));
    }

    [data-theme="dark"] .imgV1,
    [data-theme="dark"] .imgV2,
    [data-theme="dark"] .imgV3,
    [data-theme="dark"] .imgV4{
      background:
        radial-gradient(240px 140px at 22% 25%, rgba(0,201,255,.20), transparent 62%),
        radial-gradient(220px 140px at 78% 60%, rgba(255,122,24,.14), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
    }

    .pBadge{
      position:relative;
      background: color-mix(in srgb, var(--glass2) 88%, transparent);
      border: 1px solid var(--stroke);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 980;
      letter-spacing:.2px;
      color: color-mix(in srgb, var(--text) 88%, transparent);
      backdrop-filter: blur(12px);
      user-select:none;
      z-index:2;
    }

    .pBody{
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 6px;
      flex: 1 1 auto;
      min-width:0;
    }
    .pName{
      font-weight: 980;
      letter-spacing: .2px;
      font-size: 15px;
      line-height: 1.2;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .pDesc{
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
      min-height: 34px;
    }
    .pBottom{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .pPrice{
      font-weight: 980;
      letter-spacing: .2px;
      white-space: nowrap;
    }

    .miniBtn{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease), background .18s var(--ease);
      user-select:none;
      flex: 0 0 auto;
    }
    .miniBtn:active{ transform: scale(.95); }
    @media (hover:hover){
      .miniBtn:hover{ border-color: var(--stroke2); box-shadow: 0 18px 50px rgba(0,0,0,.14); }
      [data-theme="dark"] .miniBtn:hover{ box-shadow: 0 18px 60px rgba(0,0,0,.40); }
    }

    /* ===== PERFECT HEART (no tail) ===== */
    .wishBtn{
      position:absolute;
      top:10px;
      right:10px;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      backdrop-filter: blur(14px) saturate(180%);
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      padding:0;
      transition: transform .18s var(--ease), border-color .18s var(--ease), background .18s var(--ease);
      z-index:3;
    }
    .wishBtn:active{ transform: scale(.95); }
    .wishBtn svg{ width:20px; height:20px; display:block; }

    .wishPath{
      stroke: color-mix(in srgb, var(--text) 78%, transparent);
      stroke-width: 2;
      fill: rgba(0,201,255,0);
      transition: fill .22s var(--ease), stroke .22s var(--ease);
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .wishBtn.on{
      border-color: var(--stroke2);
      background: linear-gradient(135deg, rgba(0,201,255,.22), rgba(255,122,24,.10));
    }
    .wishBtn.on .wishPath{
      fill: rgba(0,201,255,.92);
      stroke: rgba(0,201,255,.92);
    }
    @keyframes heartPop{
      0%{ transform: scale(1); }
      45%{ transform: scale(1.20); }
      100%{ transform: scale(1); }
    }
    .heartPop{ animation: heartPop .22s var(--ease); }

    /* views */
    .view{ transition: opacity .20s var(--ease), transform .20s var(--ease); }
    .hidden{ opacity:0; transform: translateY(8px); pointer-events:none; position:absolute; left:-9999px; }

    .card{
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      min-width:0;
    }

    .btn{
      width:100%;
      border:0;
      border-radius: 18px;
      padding: 14px;
      font-weight: 980;
      letter-spacing: .2px;
      cursor:pointer;
      color: color-mix(in srgb, var(--text) 96%, transparent);
      background:
        radial-gradient(120% 120% at 20% 20%, rgba(255,255,255,.92), rgba(255,255,255,.72)),
        linear-gradient(135deg, rgba(0,201,255,.60), rgba(255,122,24,.25));
      box-shadow: 0 18px 70px rgba(0,201,255,.10);
      transition: transform .18s var(--ease), box-shadow .18s var(--ease);
    }
    [data-theme="dark"] .btn{
      color:#0a0e16;
      background:
        radial-gradient(120% 120% at 20% 20%, rgba(255,255,255,.92), rgba(255,255,255,.72)),
        linear-gradient(135deg, rgba(0,201,255,.85), rgba(255,122,24,.35));
    }
    .btn:active{ transform: scale(.98); }

    .btn2{
      width:100%;
      border:1px solid var(--stroke);
      border-radius: 18px;
      padding: 14px;
      font-weight: 950;
      cursor:pointer;
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      color: color-mix(in srgb, var(--text) 92%, transparent);
      transition: transform .18s var(--ease);
    }
    .btn2:active{ transform: scale(.98); }

    /* toast */
    #toast{
      position: fixed;
      left: 50%;
      bottom: calc(92px + env(safe-area-inset-bottom));
      transform: translateX(-50%) translateY(10px);
      background: var(--toastBg);
      border: 1px solid var(--stroke);
      color: var(--toastText);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 13px;
      opacity: 0;
      transition: opacity .20s var(--ease), transform .20s var(--ease);
      box-shadow: 0 26px 90px rgba(0,0,0,.18);
      z-index: 9999;
      white-space: nowrap;
      max-width: calc(100vw - 24px);
      overflow:hidden;
      text-overflow: ellipsis;
      backdrop-filter: blur(14px);
    }
    #toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); }

    /* appear */
    @keyframes fadeUp{ from{ opacity:0; transform: translateY(10px);} to{ opacity:1; transform: translateY(0);} }
    .appear{ animation: fadeUp .28s var(--ease) both; }

    /* fly dot */
    .flyDot{
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(0,201,255,.90));
      z-index: 10000;
      pointer-events: none;
      box-shadow: 0 18px 70px rgba(0,201,255,.18);
    }

    /* ===== Bottom bar smart hide ===== */
    .bar{
      position: fixed;
      left:0; right:0; bottom:0;
      z-index: 60;
      padding: 12px 14px calc(12px + env(safe-area-inset-bottom));
      background: color-mix(in srgb, var(--bg) 75%, transparent);
      backdrop-filter: blur(18px) saturate(180%);
      border-top: 1px solid var(--stroke);
      transition: transform .22s var(--ease), opacity .22s var(--ease);
    }
    .bar.hiddenBar{
      transform: translateY(110%);
      opacity:0;
      pointer-events:none;
    }
    .barInner{ max-width: 1040px; margin: 0 auto; display:flex; gap: 10px; align-items:center; }
    .barHint{ text-align:center; color: var(--muted); font-size: 12.5px; margin-top: 8px; }

    /* ===== Modals ===== */
    .modalWrap{
      position: fixed;
      inset: 0;
      background: var(--modalBg);
      backdrop-filter: blur(10px);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 20000;
      padding: 14px;
    }
    .modalWrap.show{ display:flex; }

    .sheet{
      width: min(560px, 100%);
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid var(--stroke);
      border-radius: 26px;
      box-shadow: 0 34px 120px rgba(0,0,0,.22);
      padding: 14px;
      transform: translateY(14px);
      opacity: 0;
      animation: sheetIn .20s var(--ease) forwards;
      overflow:hidden;
    }
    @keyframes sheetIn{ to{ transform: translateY(0); opacity:1; } }

    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .sheetTitle{
      font-weight:980;
      letter-spacing:.2px;
    }

    .xBtn{
      width:38px; height:38px;
      border-radius:999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .18s var(--ease);
      user-select:none;
    }
    .xBtn:active{ transform: scale(.95); }

    /* Quick View image */
    .qvImg{
      height: 210px;
      border-radius: 18px;
      border: 1px solid color-mix(in srgb, var(--stroke) 70%, transparent);
      display:flex;
      align-items:flex-end;
      padding: 12px;
      overflow:hidden;
    }

    .divider{
      height:1px;
      background: color-mix(in srgb, var(--stroke) 70%, transparent);
      margin: 12px 0;
    }

    .chipGroup{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .opt{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass) 85%, transparent);
      color: color-mix(in srgb, var(--text) 92%, transparent);
      font-weight: 950;
      cursor:pointer;
      transition: transform .18s var(--ease), border-color .18s var(--ease), background .18s var(--ease), box-shadow .18s var(--ease);
      user-select:none;
    }
    .opt:active{ transform: scale(.98); }
    .opt.on{
      border-color: var(--stroke2);
      background: linear-gradient(135deg, rgba(0,201,255,.22), rgba(255,122,24,.10));
      box-shadow: 0 16px 60px rgba(0,201,255,.10);
    }
  </style>
</head>

<body>
<header>
  <div class="container">
    <div class="head">
      <div class="brand">
        <a href="javascript:void(0)" onclick="go('catalog')" aria-label="–ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω">
          <span class="logoDot"></span>
          <span class="title">Studio Wear</span>
        </a>
        <div class="subtitle">Liquid glass ‚Ä¢ live UI ‚Ä¢ demo</div>
      </div>

      <div class="topActions">
        <!-- theme toggle -->
        <button class="iconBtn" id="themeBtn" onclick="toggleTheme()" aria-label="–¢–µ–º–∞">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path id="themeIconPath" d="M12 3a1 1 0 0 0 0 18 8 8 0 0 0 0-18z"></path>
          </svg>
        </button>

        <!-- account -->
        <button class="iconBtn" onclick="openAccount()" aria-label="–ê–∫–∫–∞—É–Ω—Ç">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21a8 8 0 0 0-16 0"></path>
            <circle cx="12" cy="8" r="4"></circle>
          </svg>
        </button>

        <!-- wishlist filter -->
        <button class="iconBtn" id="wishTopBtn" onclick="toggleWishlistView()" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path class="wishPath" d="M12 20s-7-4.5-9.2-8.1C1.2 9.2 3.1 6.6 6.2 6.6c1.8 0 3 1 3.6 1.9.6-.9 1.8-1.9 3.6-1.9 3.1 0 5 2.6 3.4 5.3C19 15.5 12 20 12 20z"></path>
          </svg>
        </button>

        <!-- cart -->
        <button class="iconBtn" id="cartBtn" onclick="go('cart')" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 6h15l-2 9H8L6 6z"></path>
            <path d="M6 6 5 3H2"></path>
            <circle cx="9" cy="20" r="1.6"></circle>
            <circle cx="18" cy="20" r="1.6"></circle>
          </svg>
          <div class="badge" id="cartBadge" style="display:none;">0</div>
        </button>
      </div>
    </div>
  </div>
</header>

<div id="toast">–ì–æ—Ç–æ–≤–æ</div>

<main class="container">
  <!-- CATALOG -->
  <div id="viewCatalog" class="view">
    <div class="panel">
      <div class="row">
        <input id="search" placeholder="–ü–æ–∏—Å–∫: —Ç–æ–ø, –ª–µ–≥–∏–Ω—Å—ã, –∫–æ–º–ø–ª–µ–∫—Ç‚Ä¶" oninput="applyFilters()" />
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="chip active" id="chip_all" onclick="setCategory('all')">–í—Å–µ</button>
        <button class="chip" id="chip_sets" onclick="setCategory('sets')">–ö–æ–º–ø–ª–µ–∫—Ç—ã</button>
        <button class="chip" id="chip_tops" onclick="setCategory('tops')">–¢–æ–ø—ã</button>
        <button class="chip" id="chip_leggings" onclick="setCategory('leggings')">–õ–µ–≥–∏–Ω—Å—ã</button>
        <button class="chip" id="chip_leotards" onclick="setCategory('leotards')">–ö—É–ø–∞–ª—å–Ω–∏–∫–∏</button>
      </div>

      <div class="hint" id="catalogHint">
        <span>Quick view</span><span>–†–∞–∑–º–µ—Ä/—Ü–≤–µ—Ç</span><span>–î–æ—Å—Ç–∞–≤–∫–∞</span><span>–û–ø–ª–∞—Ç–∞ (—Å–∫–æ—Ä–æ)</span>
      </div>
    </div>

    <div class="grid" id="catalog"></div>
  </div>

  <!-- CART -->
  <div id="viewCart" class="view hidden">
    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div style="font-size:18px; font-weight:980;">–ö–æ—Ä–∑–∏–Ω–∞</div>
        <button class="chip active" id="cartTotal" style="cursor:default;">–ò—Ç–æ–≥–æ: 0‚ÇΩ</button>
      </div>

      <div id="cartList" style="margin-top:10px;"></div>

      <button class="btn" onclick="go('checkout')" style="margin-top:12px;">
        –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
      </button>
      <button class="btn2" onclick="go('catalog')" style="margin-top:10px;">
        ‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
      </button>
    </div>
  </div>

  <!-- CHECKOUT -->
  <div id="viewCheckout" class="view hidden">
    <div class="card">
      <button class="btn2" onclick="go('cart')" style="margin-top:0;">‚Üê –ù–∞–∑–∞–¥</button>

      <div style="font-size:18px; font-weight:980; margin:12px 0 6px;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ (–¥–µ–º–æ)</div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;" class="two">
        <div>
          <div class="subtitle" style="margin:6px 0;">–ò–º—è</div>
          <input id="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—à–∞" />
        </div>
        <div>
          <div class="subtitle" style="margin:6px 0;">–¢–µ–ª–µ—Ñ–æ–Ω</div>
          <input id="phone" placeholder="+7 ..." />
        </div>
      </div>

      <div class="subtitle" style="margin:10px 0 6px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—Ä–∞–∑–º–µ—Ä/—Ü–≤–µ—Ç/–¥–æ—Å—Ç–∞–≤–∫–∞)</div>
      <textarea id="comment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–∞–∑–º–µ—Ä M, —Ü–≤–µ—Ç Ice, –¥–æ—Å—Ç–∞–≤–∫–∞ –°–î–≠–ö"></textarea>

      <button class="btn" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ Telegram</button>
      <div class="subtitle" style="margin-top:10px;">
        * –î–µ–º–æ. –†–µ–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –¥–∞–ª—å—à–µ (–°–ë–ü/–∫–∞—Ä—Ç—ã).
      </div>
    </div>
  </div>
</main>

<!-- bottom bar (smart) -->
<div class="bar" id="bottomBar">
  <div class="barInner">
    <button class="btn" onclick="go('cart')">–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>
  <div class="barHint">–ë–µ–∑ —Å–∞–π—Ç–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Ä¢ –ø—Ä—è–º–æ –≤ Telegram</div>
</div>

<!-- ACCOUNT MODAL -->
<div class="modalWrap" id="accountModal" onclick="closeAccount()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheetHeader">
      <div class="sheetTitle">–ê–∫–∫–∞—É–Ω—Ç</div>
      <button class="xBtn" onclick="closeAccount()">‚úï</button>
    </div>

    <div class="subtitle" style="margin-bottom:10px;">
      –î–µ–º–æ-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–º—è –∏–∑ Telegram –ø—Ä–æ—Ñ–∏–ª—è (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏ Telegram).
    </div>

    <div class="row" style="gap:10px; align-items:center;">
      <div style="width:38px;height:38px;border-radius:999px;background:linear-gradient(135deg,rgba(0,201,255,.20),rgba(255,122,24,.14));border:1px solid var(--stroke);box-shadow:0 18px 60px rgba(0,201,255,.10);"></div>
      <div style="min-width:0;">
        <div style="font-weight:980; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" id="accName">–ì–æ—Å—Ç—å</div>
        <div class="subtitle" id="accUser">–û—Ç–∫—Ä–æ–π—Ç–µ –≤–Ω—É—Ç—Ä–∏ Telegram</div>
      </div>
    </div>

    <button class="btn2" style="margin-top:12px;" onclick="tryFillCheckoutFromProfile()">
      –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
    </button>

    <button class="btn2" style="margin-top:10px;" onclick="clearLocal()">
      –û—á–∏—Å—Ç–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    </button>
  </div>
</div>

<!-- QUICK VIEW MODAL -->
<div class="modalWrap" id="qvModal" onclick="closeQV()">
  <div class="sheet" onclick="event.stopPropagation()">
    <!-- IMPORTANT: header has ONLY title + close -->
    <div class="sheetHeader">
      <div class="sheetTitle">–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</div>
      <button class="xBtn" onclick="closeQV()">‚úï</button>
    </div>

    <div class="qvImg" id="qvImg">
      <div class="pBadge" id="qvBadge">Studio</div>
    </div>

    <div style="margin-top:12px;">
      <div style="font-size:18px; font-weight:980;" id="qvName">‚Äî</div>
      <div class="subtitle" style="margin-top:6px;" id="qvDesc">‚Äî</div>

      <!-- actions row: heart is here (CANNOT overlap close now) -->
      <div class="row" style="margin-top:12px; justify-content:space-between;">
        <div style="font-weight:980; font-size:18px;" id="qvPrice">‚Äî</div>

        <div class="row" style="gap:8px;">
          <button class="wishBtn" id="qvWishBtn" onclick="toggleWish(window.__qvId, true)" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path class="wishPath" d="M12 20s-7-4.5-9.2-8.1C1.2 9.2 3.1 6.6 6.2 6.6c1.8 0 3 1 3.6 1.9.6-.9 1.8-1.9 3.6-1.9 3.1 0 5 2.6 3.4 5.3C19 15.5 12 20 12 20z"></path>
            </svg>
          </button>

          <button class="miniBtn" id="qvAddBtn" onclick="addToCart(window.__qvId, document.getElementById('qvAddBtn'), true)" aria-label="–í –∫–æ—Ä–∑–∏–Ω—É">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 6h15l-2 9H8L6 6z"></path>
              <path d="M6 6 5 3H2"></path>
              <circle cx="9" cy="20" r="1.6"></circle>
              <circle cx="18" cy="20" r="1.6"></circle>
            </svg>
          </button>
        </div>
      </div>

      <div class="divider"></div>

      <div style="font-weight:950;">–†–∞–∑–º–µ—Ä</div>
      <div class="chipGroup" id="sizeChips"></div>

      <div style="margin-top:10px; font-weight:950;">–¶–≤–µ—Ç</div>
      <div class="chipGroup" id="colorChips"></div>

      <button class="btn" style="margin-top:14px;" onclick="addToCart(window.__qvId, document.getElementById('qvAddBtn'), true)">
        –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
      </button>
    </div>
  </div>
</div>

<script>
  const OWNER_USERNAME = "egorkrab"; // username –≤–ª–∞–¥–µ–ª–∏—Ü—ã (–±–µ–∑ @)

  // theme
  const THEME_KEY = "sw_theme_v1";
  function setTheme(t){
    document.documentElement.setAttribute("data-theme", t);
    localStorage.setItem(THEME_KEY, t);
    updateThemeIcon();
  }
  function toggleTheme(){
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    setTheme(cur === "light" ? "dark" : "light");
    showToast(cur === "light" ? "–¢—ë–º–Ω–∞—è —Ç–µ–º–∞" : "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞");
    haptic("impact");
  }
  function updateThemeIcon(){
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    const p = document.getElementById("themeIconPath");
    // sun / moon minimal
    if(cur === "light"){
      p.setAttribute("d","M12 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8z M12 2v1 M12 21v1 M4.2 4.2l.7.7 M19.1 19.1l.7.7 M2 12h1 M21 12h1 M4.2 19.8l.7-.7 M19.1 4.9l.7-.7");
    } else {
      p.setAttribute("d","M21 12.7A7.5 7.5 0 0 1 11.3 3a6 6 0 1 0 9.7 9.7z");
    }
  }

  // data
  const PRODUCTS = [
    { id:"set1", cat:"sets", badge:"Studio",  img:"imgV1", name:"Silk Line Set",        desc:"–ö–æ–º–ø–ª–µ–∫—Ç ‚Ä¢ –º—è–≥–∫–∞—è –ø–æ—Å–∞–¥–∫–∞",             price:3490, sizes:["XS","S","M","L"], colors:["Ice","Black","Sand"] },
    { id:"set2", cat:"sets", badge:"Elegant", img:"imgV2", name:"Contour Set",          desc:"–ö–æ–º–ø–ª–µ–∫—Ç ‚Ä¢ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –ª–∏–Ω–∏—é",         price:3790, sizes:["XS","S","M","L"], colors:["Black","Neon Ice"] },
    { id:"set3", cat:"sets", badge:"Core",    img:"imgV3", name:"Minimal Set",          desc:"–ö–æ–º–ø–ª–µ–∫—Ç ‚Ä¢ –±–∞–∑–æ–≤—ã–π —Å—Ç—É–¥–∏–π–Ω—ã–π",          price:3290, sizes:["XS","S","M","L"], colors:["Sand","Black"] },

    { id:"leo1", cat:"leotards", badge:"Elegant", img:"imgV4", name:"Contour Leotard",  desc:"–ö—É–ø–∞–ª—å–Ω–∏–∫ ‚Ä¢ –ø–æ—Å–∞–¥–∫–∞ –ø–æ —Ñ–∏–≥—É—Ä–µ",         price:2590, sizes:["XS","S","M","L"], colors:["Black","Ice"] },
    { id:"leo2", cat:"leotards", badge:"Studio",  img:"imgV1", name:"Line Leotard",     desc:"–ö—É–ø–∞–ª—å–Ω–∏–∫ ‚Ä¢ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è —Ç–∫–∞–Ω—å",          price:2390, sizes:["XS","S","M","L"], colors:["Ice","Sand"] },
    { id:"leo3", cat:"leotards", badge:"Soft",    img:"imgV2", name:"Air Leotard",      desc:"–ö—É–ø–∞–ª—å–Ω–∏–∫ ‚Ä¢ –º—è–≥–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",          price:2290, sizes:["XS","S","M"],     colors:["Sand","Ice"] },

    { id:"top1", cat:"tops", badge:"Soft",    img:"imgV3", name:"Studio Top",           desc:"–¢–æ–ø ‚Ä¢ –º—è–≥–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",                price:1490, sizes:["XS","S","M"],     colors:["Ice","Black","Orange Pop"] },
    { id:"top2", cat:"tops", badge:"Core",    img:"imgV4", name:"Classic Top",          desc:"–¢–æ–ø ‚Ä¢ –±–∞–∑–æ–≤—ã–π —Å–∏–ª—É—ç—Ç",                  price:1390, sizes:["XS","S","M","L"], colors:["Black","Sand"] },
    { id:"top3", cat:"tops", badge:"Elegant", img:"imgV1", name:"Line Top",             desc:"–¢–æ–ø ‚Ä¢ —á–∏—Å—Ç–∞—è –ª–∏–Ω–∏—è",                    price:1590, sizes:["XS","S","M","L"], colors:["Ice","Black"] },

    { id:"leg1", cat:"leggings", badge:"Core",   img:"imgV2", name:"High Waist Leggings",  desc:"–õ–µ–≥–∏–Ω—Å—ã ‚Ä¢ –≤—ã—Å–æ–∫–∞—è –ø–æ—Å–∞–¥–∫–∞",         price:1990, sizes:["XS","S","M","L"], colors:["Black","Sand"] },
    { id:"leg2", cat:"leggings", badge:"Studio", img:"imgV3", name:"Second Skin Leggings",desc:"–õ–µ–≥–∏–Ω—Å—ã ‚Ä¢ –∫–∞–∫ –≤—Ç–æ—Ä–∞—è –∫–æ–∂–∞",           price:2190, sizes:["XS","S","M","L"], colors:["Sand","Black","Ice"] },
    { id:"leg3", cat:"leggings", badge:"Soft",   img:"imgV4", name:"Smooth Leggings",      desc:"–õ–µ–≥–∏–Ω—Å—ã ‚Ä¢ –º—è–≥–∫–∞—è —Ç–∫–∞–Ω—å",             price:1890, sizes:["XS","S","M","L"], colors:["Ice","Black"] },
  ];

  const CART_KEY = "sw_cart_v3";
  const WISH_KEY = "sw_wish_v3";
  const SEL_KEY  = "sw_sel_v3";

  function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || "{}"); }
  function setCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateUI(); }

  function getWish(){ return JSON.parse(localStorage.getItem(WISH_KEY) || "[]"); }
  function setWish(arr){ localStorage.setItem(WISH_KEY, JSON.stringify(arr)); updateUI(); }

  function getSel(){ return JSON.parse(localStorage.getItem(SEL_KEY) || "{}"); }
  function setSel(obj){ localStorage.setItem(SEL_KEY, JSON.stringify(obj)); }

  // haptics + toast
  function haptic(type){
    try{
      const H = window.Telegram?.WebApp?.HapticFeedback;
      if(!H) return;
      if(type === "impact") H.impactOccurred("light");
      if(type === "success") H.notificationOccurred("success");
    }catch(e){}
  }
  function showToast(text="–ì–æ—Ç–æ–≤–æ"){
    const t = document.getElementById("toast");
    t.textContent = text;
    t.classList.add("show");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=>t.classList.remove("show"), 1200);
  }

  function bumpCartBadge(){
    const badge = document.getElementById("cartBadge");
    badge.classList.remove("bumpBadge");
    void badge.offsetWidth;
    badge.classList.add("bumpBadge");
  }

  function flyToCart(fromEl){
    if(!fromEl) return;
    const cartBtn = document.getElementById("cartBtn");
    const a = fromEl.getBoundingClientRect();
    const b = cartBtn.getBoundingClientRect();

    const dot = document.createElement("div");
    dot.className = "flyDot";
    dot.style.left = (a.left + a.width/2 - 5) + "px";
    dot.style.top  = (a.top + a.height/2 - 5) + "px";
    document.body.appendChild(dot);

    const startX = a.left + a.width/2;
    const startY = a.top + a.height/2;
    const endX = b.left + b.width/2;
    const endY = b.top + b.height/2;

    const dx = endX - startX;
    const dy = endY - startY;

    const duration = 440;
    const start = performance.now();

    function step(t){
      const p = Math.min(1, (t - start)/duration);
      const e = 1 - Math.pow(1 - p, 3);
      const arc = Math.sin(p * Math.PI) * -54;
      dot.style.transform = `translate(${dx*e}px, ${dy*e + arc}px) scale(${1 - 0.35*p})`;
      dot.style.opacity = String(1 - 0.2*p);
      if(p < 1) requestAnimationFrame(step);
      else dot.remove();
    }
    requestAnimationFrame(step);
  }

  function pulseHeart(btn){
    if(!btn) return;
    btn.classList.remove("heartPop");
    void btn.offsetWidth;
    btn.classList.add("heartPop");
  }

  // routes + bottom bar
  function currentRoute(){
    const h = (location.hash || "#/").replace("#/","");
    return h || "catalog";
  }
  function updateBottomBar(){
    const page = currentRoute();
    const bar = document.getElementById("bottomBar");
    bar.classList.toggle("hiddenBar", (page === "cart" || page === "checkout"));
  }

  function showView(name){
    const map = { catalog:"viewCatalog", cart:"viewCart", checkout:"viewCheckout" };
    Object.values(map).forEach(id => document.getElementById(id).classList.add("hidden"));
    document.getElementById(map[name]).classList.remove("hidden");
    updateUI();
    updateBottomBar();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
  function go(name){ location.hash = name === "catalog" ? "#/" : `#/${name}`; }
  function handleRoute(){
    const page = currentRoute();
    if(page === "cart") showView("cart");
    else if(page === "checkout") showView("checkout");
    else showView("catalog");
  }
  window.addEventListener("hashchange", handleRoute);

  // wishlist view + category
  let currentCategory = "all";
  let wishlistView = false;

  function setCategory(cat){
    currentCategory = cat;
    ["all","sets","tops","leggings","leotards"].forEach(x=>{
      const el = document.getElementById("chip_"+x);
      if(el) el.classList.toggle("active", x===cat);
    });
    wishlistView = false;
    document.getElementById("wishTopBtn").classList.remove("on");
    applyFilters();
    haptic("impact");
  }

  function toggleWishlistView(){
    wishlistView = !wishlistView;
    document.getElementById("wishTopBtn").classList.toggle("on", wishlistView);

    const hint = document.getElementById("catalogHint");
    hint.innerHTML = wishlistView
      ? `<span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</span><span>Liquid glass</span>`
      : `<span>Quick view</span><span>–†–∞–∑–º–µ—Ä/—Ü–≤–µ—Ç</span><span>–î–æ—Å—Ç–∞–≤–∫–∞</span><span>–û–ø–ª–∞—Ç–∞ (—Å–∫–æ—Ä–æ)</span>`;

    applyFilters();
    showToast(wishlistView ? "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" : "–ö–∞—Ç–∞–ª–æ–≥");
    haptic("impact");
  }

  function isWished(id){ return getWish().includes(id); }

  function toggleWish(id, fromQV=false){
    const arr = getWish();
    const i = arr.indexOf(id);
    if(i >= 0) arr.splice(i,1);
    else arr.push(id);
    setWish(arr);

    // IMPORTANT: heart click should NOT open popup. We only toggle.
    applyFilters();
    syncQVWish();
    showToast(arr.includes(id) ? "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º" : "–£–±—Ä–∞–Ω–æ");
    haptic("success");

    if(fromQV) pulseHeart(document.getElementById("qvWishBtn"));
    else pulseHeart(document.querySelector(`[data-wish="${id}"]`));
  }

  function applyFilters(){
    const q = (document.getElementById("search")?.value || "").trim().toLowerCase();
    const wish = new Set(getWish());

    const filtered = PRODUCTS.filter(p=>{
      const matchWish = !wishlistView || wish.has(p.id);
      const matchCat = currentCategory === "all" || p.cat === currentCategory;
      const matchQ = !q || (p.name + " " + p.desc + " " + p.badge).toLowerCase().includes(q);
      return matchWish && matchCat && matchQ;
    });

    renderCatalog(filtered);
  }

  // quick view chips
  function renderChips(containerId, values, selected, onPick){
    const el = document.getElementById(containerId);
    el.innerHTML = "";
    values.forEach(v=>{
      const b = document.createElement("button");
      b.className = "opt" + (v === selected ? " on" : "");
      b.textContent = v;
      b.onclick = ()=>{
        [...el.querySelectorAll(".opt")].forEach(x=>x.classList.remove("on"));
        b.classList.add("on");
        onPick(v);
      };
      el.appendChild(b);
    });
  }

  function openQV(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;

    window.__qvId = id;

    document.getElementById("qvBadge").textContent = p.badge;
    document.getElementById("qvName").textContent  = p.name;
    document.getElementById("qvDesc").textContent  = p.desc;
    document.getElementById("qvPrice").textContent = `${p.price}‚ÇΩ`;

    const qvImg = document.getElementById("qvImg");
    qvImg.className = `qvImg ${p.img}`;

    const sel = getSel();
    const saved = sel[id] || {};
    if(!saved.size) saved.size = p.sizes?.[0] || "";
    if(!saved.color) saved.color = p.colors?.[0] || "";

    renderChips("sizeChips", p.sizes || [], saved.size, (val)=>{
      saved.size = val; sel[id]=saved; setSel(sel); haptic("impact");
    });
    renderChips("colorChips", p.colors || [], saved.color, (val)=>{
      saved.color = val; sel[id]=saved; setSel(sel); haptic("impact");
    });

    sel[id]=saved; setSel(sel);

    syncQVWish();
    document.getElementById("qvModal").classList.add("show");
    haptic("impact");
  }

  function syncQVWish(){
    const id = window.__qvId;
    const btn = document.getElementById("qvWishBtn");
    if(!btn || !id) return;
    btn.classList.toggle("on", isWished(id));
  }

  function closeQV(){ document.getElementById("qvModal").classList.remove("show"); }
  function closeAccount(){ document.getElementById("accountModal").classList.remove("show"); }

  // render catalog (heart click only toggles)
  function renderCatalog(list){
    const el = document.getElementById("catalog");
    el.innerHTML = "";

    if(!list.length){
      el.innerHTML = `<div class="subtitle" style="padding: 12px 6px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`;
      return;
    }

    list.forEach((p, i)=>{
      const card = document.createElement("div");
      card.className = "productCard appear";
      card.style.animationDelay = (Math.min(i, 14) * 18) + "ms";

      const wished = isWished(p.id);

      card.innerHTML = `
        <button class="wishBtn ${wished ? "on" : ""}" data-wish="${p.id}" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <!-- tail-less symmetric-ish heart -->
            <path class="wishPath" d="M12 20s-7-4.5-9.2-8.1C1.2 9.2 3.1 6.6 6.2 6.6c1.8 0 3 1 3.6 1.9.6-.9 1.8-1.9 3.6-1.9 3.1 0 5 2.6 3.4 5.3C19 15.5 12 20 12 20z"></path>
          </svg>
        </button>

        <div class="pImg ${p.img}" data-qv="${p.id}">
          <div class="pBadge">${p.badge}</div>
        </div>

        <div class="pBody">
          <div class="pName" title="${p.name}">${p.name}</div>
          <div class="pDesc">${p.desc}</div>
          <div class="pBottom">
            <div class="pPrice">${p.price}‚ÇΩ</div>
            <button class="miniBtn" data-add="${p.id}" aria-label="–í –∫–æ—Ä–∑–∏–Ω—É">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 6h15l-2 9H8L6 6z"></path>
                <path d="M6 6 5 3H2"></path>
                <circle cx="9" cy="20" r="1.6"></circle>
                <circle cx="18" cy="20" r="1.6"></circle>
              </svg>
            </button>
          </div>
        </div>
      `;
      el.appendChild(card);
    });

    // open QV only by clicking image (NOT hearts)
    el.querySelectorAll("[data-qv]").forEach(img=>{
      img.addEventListener("click", ()=> openQV(img.getAttribute("data-qv")));
    });

    // add to cart
    el.querySelectorAll("[data-add]").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        e.stopPropagation();
        addToCart(btn.getAttribute("data-add"), btn, false);
      });
    });

    // wishlist: click toggles only
    el.querySelectorAll("[data-wish]").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        e.stopPropagation();
        const id = btn.getAttribute("data-wish");
        toggleWish(id, false);
      });
    });
  }

  // cart
  function cartCount(){
    const c = getCart();
    return Object.values(c).reduce((a,b)=>a+b,0);
  }

  function cartSummary(){
    const c = getCart();
    let total = 0;
    const items = [];
    for (const [id, qty] of Object.entries(c)){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) continue;
      total += p.price * qty;
      items.push({ p, qty });
    }
    return { items, total };
  }

  function addToCart(id, fromEl=null, closePopup=false){
    const c = getCart();
    c[id] = (c[id] || 0) + 1;
    setCart(c);

    if(fromEl) flyToCart(fromEl);
    bumpCartBadge();

    const p = PRODUCTS.find(x=>x.id===id);
    showToast(p ? `–í –∫–æ—Ä–∑–∏–Ω–µ: ${p.name}` : "–î–æ–±–∞–≤–ª–µ–Ω–æ");
    haptic("success");

    // IMPORTANT: if added from popup ‚Äî close it
    if(closePopup) closeQV();
  }

  function removeFromCart(id){
    const c = getCart();
    if (!c[id]) return;
    c[id] -= 1;
    if (c[id] <= 0) delete c[id];
    setCart(c);
    haptic("impact");
  }

  function updateUI(){
    const count = cartCount();
    const badge = document.getElementById("cartBadge");
    badge.textContent = String(count);
    badge.style.display = count > 0 ? "flex" : "none";

    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    if(cartList && cartTotal){
      const { items, total } = cartSummary();
      cartTotal.textContent = `–ò—Ç–æ–≥–æ: ${total}‚ÇΩ`;

      const sel = getSel();

      if(!items.length){
        cartList.innerHTML = `<div class="subtitle" style="padding:10px 0;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è.</div>`;
        cartTotal.textContent = `–ò—Ç–æ–≥–æ: 0‚ÇΩ`;
      } else {
        cartList.innerHTML = items.map(({p, qty})=>{
          const s = sel[p.id] || {};
          const size = s.size || (p.sizes?.[0] || "‚Äî");
          const color = s.color || (p.colors?.[0] || "‚Äî");
          return `
            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; border-bottom:1px solid color-mix(in srgb, var(--stroke) 70%, transparent);">
              <div style="min-width:0;">
                <div style="font-weight:980; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${p.name}</div>
                <div class="subtitle">${p.price}‚ÇΩ ‚Ä¢ size: ${size} ‚Ä¢ color: ${color}</div>
              </div>
              <div class="row" style="gap:8px; flex:0 0 auto; flex-wrap:nowrap;">
                <button class="miniBtn" onclick="removeFromCart('${p.id}')" aria-label="–ú–∏–Ω—É—Å"><span style="font-weight:980; font-size:16px; line-height:0;">‚àí</span></button>
                <button class="chip active" style="padding:8px 10px; cursor:default;">${qty}</button>
                <button class="miniBtn" onclick="addToCart('${p.id}')" aria-label="–ü–ª—é—Å"><span style="font-weight:980; font-size:16px; line-height:0;">+</span></button>
              </div>
            </div>
          `;
        }).join("");
      }
    }

    updateBottomBar();
  }

  // order send
  function sendOrder(){
    const { items, total } = cartSummary();
    if(!items.length){ alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è üòÖ"); return; }

    const name = document.getElementById("name").value.trim() || "‚Äî";
    const phone = document.getElementById("phone").value.trim() || "‚Äî";
    const comment = document.getElementById("comment").value.trim() || "‚Äî";

    const sel = getSel();

    const lines = items.map(({p, qty})=>{
      const s = sel[p.id] || {};
      const size = s.size || (p.sizes?.[0] || "‚Äî");
      const color = s.color || (p.colors?.[0] || "‚Äî");
      return `${p.name} (size: ${size}, color: ${color}) √ó ${qty} = ${p.price*qty}‚ÇΩ`;
    }).join("\n- ");

    const text =
`üõçÔ∏è –ó–∞–∫–∞–∑ (–¥–µ–º–æ)
–ò–º—è: ${name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}

–¢–æ–≤–∞—Ä—ã:
- ${lines}

–ò—Ç–æ–≥–æ: ${total}‚ÇΩ
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}`;

    const url = `https://t.me/${OWNER_USERNAME}?text=${encodeURIComponent(text)}`;
    if (window.Telegram?.WebApp?.openTelegramLink) window.Telegram.WebApp.openTelegramLink(url);
    else window.open(url, "_blank");
    haptic("success");
  }

  // account profile
  function getTelegramUser(){
    try{ return window.Telegram?.WebApp?.initDataUnsafe?.user || null; } catch(e){ return null; }
  }
  function formatName(u){
    const f = (u?.first_name || "").trim();
    const l = (u?.last_name || "").trim();
    return (f + " " + l).trim() || "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å";
  }
  function fillAccountUI(){
    const u = getTelegramUser();
    const accName = document.getElementById("accName");
    const accUser = document.getElementById("accUser");
    if(u){
      accName.textContent = formatName(u);
      accUser.textContent = u.username ? ("@" + u.username) : ("id: " + u.id);
    } else {
      accName.textContent = "–ì–æ—Å—Ç—å";
      accUser.textContent = "–û—Ç–∫—Ä–æ–π—Ç–µ –≤–Ω—É—Ç—Ä–∏ Telegram";
    }
  }
  function openAccount(){
    fillAccountUI();
    document.getElementById("accountModal").classList.add("show");
    haptic("impact");
  }
  function tryFillCheckoutFromProfile(){
    const u = getTelegramUser();
    if(!u){ showToast("–û—Ç–∫—Ä–æ–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω –≤–Ω—É—Ç—Ä–∏ Telegram"); return; }
    const name = document.getElementById("name");
    if(name) name.value = formatName(u);
    showToast("–ó–∞–ø–æ–ª–Ω–∏–ª –∏–º—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è");
    haptic("success");
  }

  function clearLocal(){
    localStorage.removeItem(CART_KEY);
    localStorage.removeItem(WISH_KEY);
    localStorage.removeItem(SEL_KEY);
    wishlistView = false;
    document.getElementById("wishTopBtn").classList.remove("on");
    applyFilters();
    updateUI();
    showToast("–û—á–∏—â–µ–Ω–æ");
  }

  // init
  function init(){
    try{ window.Telegram?.WebApp?.ready?.(); window.Telegram?.WebApp?.expand?.(); }catch(e){}

    // theme load
    const savedTheme = localStorage.getItem(THEME_KEY) || "light";
    setTheme(savedTheme);

    handleRoute();
    applyFilters();
    updateUI();
  }

  init();
</script>
</body>
</html>
